<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coordinate transformations &mdash; GridKit 0.1.0.dev documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=0e73a448"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Combining land cover and DEM" href="elevation_distribution_per_land_cover.html" />
    <link rel="prev" title="Resampling" href="resampling.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            GridKit
          </a>
              <div class="version">
                0.1.0.dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Example Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#cell-centric">Cell centric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#grid-definitions">Grid definitions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#raster-operations">Raster operations</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ndvi.html">NDVI</a></li>
<li class="toctree-l3"><a class="reference internal" href="parial_overlap.html">Partial overlap</a></li>
<li class="toctree-l3"><a class="reference internal" href="resampling.html">Resampling</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Coordinate transformations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#warped-grids">Warped grids</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="elevation_distribution_per_land_cover.html">Combining land cover and DEM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#vector-data-interactions">Vector data interactions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GridKit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Example Gallery</a></li>
      <li class="breadcrumb-item active">Coordinate transformations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/example_gallery/raster_operations/coordinate_transformations.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-example-gallery-raster-operations-coordinate-transformations-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="coordinate-transformations">
<span id="sphx-glr-example-gallery-raster-operations-coordinate-transformations-py"></span><h1>Coordinate transformations<a class="headerlink" href="#coordinate-transformations" title="Permalink to this heading"></a></h1>
<p id="example-coordinate-transformations">Transform a grid from one CRS to another</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>A Coordinate Reference System (CRS) is a means of representing a 3D surface (usually of Earth) onto a 2D map. There are many Coordinate Reference Systems, all with their own advantages and discrepencies. There is no one CRS to
rule them all, there are only tradeoffs. That said, it is generally recommended to use a locally defined CRS when possible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In gridkit, a CRS is optional. If you represent, say,  a generic image as a grid there is no need for a CRS. By default, the CRS property on a grid is None. It can either be supplied when the grid is initiated or by setting the propery on the grid after creation, e.g. <code class="docutils literal notranslate"><span class="pre">grid.crs</span> <span class="pre">=</span> <span class="pre">4326</span></code>.</p>
</div>
</section>
<section id="warped-grids">
<h2>Warped grids<a class="headerlink" href="#warped-grids" title="Permalink to this heading"></a></h2>
<p>Grids always have straight lines in the CRS they are defined in.
When a straigt line is transformed to a different CRS, it often gets warped.
To demonstrate this, let’s create a grid in WGS84 (epsg code 4326) and transform the coordinates of each cell to CRS UTM N29 (epsg code 32629).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">gridkit</span> <span class="kn">import</span> <span class="n">BoundedRectGrid</span>

<span class="c1"># Create a new grid</span>
<span class="n">grid_wgs84</span> <span class="o">=</span> <span class="n">BoundedRectGrid</span><span class="p">(</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
    <span class="n">crs</span><span class="o">=</span><span class="mi">4236</span><span class="p">,</span>
    <span class="n">nodata_value</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="s2">&quot;float32&quot;</span>
<span class="p">)</span>  <span class="c1"># use float dtype to be able to represent nans as nodata</span>

<span class="c1"># Plot the grid in it&#39;s native CRS</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grid_wgs84</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">grid_wgs84</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original grid in WGS84&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$^\circ$Lon&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$^\circ$Lat&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_coordinate_transformations_001.png" srcset="../../_images/sphx_glr_coordinate_transformations_001.png" alt="Original grid in WGS84" class = "sphx-glr-single-img"/><p>This is what the grid looks like it it’s native CRS.
Now let’s transform the grid’s cell centers</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyproj.transformer</span> <span class="kn">import</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">Transformer</span>

<span class="n">utm_epsg</span> <span class="o">=</span> <span class="mi">32629</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span>
    <span class="n">grid_wgs84</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">utm_epsg</span><span class="p">),</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>  <span class="c1"># UTM zone 28N</span>

<span class="n">wgs84_centroids_utm</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
    <span class="o">*</span><span class="n">grid_wgs84</span><span class="o">.</span><span class="n">centroid</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="p">)</span>  <span class="c1"># transform each cell</span>

<span class="c1"># Plot the cell centers as a scatter plot, color them using their data value</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">wgs84_centroids_utm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">grid_wgs84</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WGS84 grid cells transformed to UTM&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x [metre]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y [metre]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_coordinate_transformations_002.png" srcset="../../_images/sphx_glr_coordinate_transformations_002.png" alt="WGS84 grid cells transformed to UTM" class = "sphx-glr-single-img"/><p>Notice how the whole grid is warped.
There is nothing we can do to combat the warping.
In order to work with a grid in a different CRS
it needs to be resampled onto a grid that is straight in the new CRS.
That is what happens when we call the <code class="docutils literal notranslate"><span class="pre">to_crs()</span></code> method on the grid.
A new grid is crated that is straigt in the desired CRS. The values of the new grid cells are interpolated from the transformed values of the source grid.
To demonstrate this principle, let’s plot the straight grid as red dots on top of the warped one, containing the original data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid_utm</span> <span class="o">=</span> <span class="n">grid_wgs84</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">utm_epsg</span><span class="p">)</span>  <span class="c1"># resample using to_crs</span>

<span class="c1"># Plot the cells of the source grid in the new CRS</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">wgs84_centroids_utm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">grid_wgs84</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="c1"># Plot the location of the new cells</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">grid_utm</span><span class="o">.</span><span class="n">centroid</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;New UTM grid on top of WGS84 grid in UTM&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x [metre]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y [metre]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_coordinate_transformations_003.png" srcset="../../_images/sphx_glr_coordinate_transformations_003.png" alt="New UTM grid on top of WGS84 grid in UTM" class = "sphx-glr-single-img"/><p>Now we showed only the location of the new grid cells,
but when <code class="docutils literal notranslate"><span class="pre">to_crs()</span></code> was called, the data already got resampled.
By default the ‘nearest’ <code class="docutils literal notranslate"><span class="pre">resample_method</span></code> is used.
Let’s plot the new grid with the transformed WGS84 cell locations on top to see what happened.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grid_utm</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">grid_utm</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">wgs84_centroids_utm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_coordinate_transformations_004.png" srcset="../../_images/sphx_glr_coordinate_transformations_004.png" alt="coordinate transformations" class = "sphx-glr-single-img"/><p>For a smoother result, the ‘bilinear’ <code class="docutils literal notranslate"><span class="pre">resample_method</span></code> can be used.
This does lead to artifacts at the boundaries.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid_utm</span> <span class="o">=</span> <span class="n">grid_wgs84</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">utm_epsg</span><span class="p">,</span> <span class="n">resample_method</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grid_utm</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">grid_utm</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">wgs84_centroids_utm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_coordinate_transformations_005.png" srcset="../../_images/sphx_glr_coordinate_transformations_005.png" alt="coordinate transformations" class = "sphx-glr-single-img"/><p><code class="docutils literal notranslate"><span class="pre">to_crs()</span></code> is just a shorthand for creating a grid with the same properties as the source grid, but with a different CRS, and calling resample.
Any time <code class="docutils literal notranslate"><span class="pre">source_grid.resample(target_grid)</span></code> is called, the CRS of the grids are compared. If they are different, the logic described in this example is applied.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.708 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-example-gallery-raster-operations-coordinate-transformations-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/3eb6e372e071e958ff8e1f3028b6658e/coordinate_transformations.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">coordinate_transformations.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/1155c403f2f6a04be805354b6d142880/coordinate_transformations.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">coordinate_transformations.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="resampling.html" class="btn btn-neutral float-left" title="Resampling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="elevation_distribution_per_land_cover.html" class="btn btn-neutral float-right" title="Combining land cover and DEM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Timo Millenaar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>