<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Partial overlap &mdash; GridKit v0.11.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
    <link rel="canonical" href="https://tmillenaar.github.io/GridKit/versions/v0.11.0/example_gallery/raster_operations/parial_overlap.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5899e6ac"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Resampling" href="resampling.html" />
    <link rel="prev" title="NDVI" href="ndvi.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            GridKit
          </a>
              <div class="version">
                v0.11.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Example Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#cell-centric">Cell centric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#grid-definitions">Grid definitions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#raster-operations">Raster operations</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ndvi.html">NDVI</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Partial overlap</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nodata-values">Nodata values</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="resampling.html">Resampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="coordinate_transformations.html">Coordinate transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="elevation_distribution_per_land_cover.html">Combining land cover and DEM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#vector-data-interactions">Vector data interactions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GridKit</a>
      </nav>

      <div class="wy-nav-content">
  
    <div style="
        background-color: #ffefc2;
        color: #333;
        padding: 1em;
        border-bottom: 2px solid #e6c200;
        font-weight: bold;
        text-align: center;
    ">
      You are viewing an <strong>outdated version</strong> of the documentation (v0.11.0).<br>
      Latest version: <a href="../../../v1.0.0/index.html">v1.0.0</a>
    </div>
  
  
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Example Gallery</a></li>
      <li class="breadcrumb-item active">Partial overlap</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/example_gallery/raster_operations/parial_overlap.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-example-gallery-raster-operations-parial-overlap-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="partial-overlap">
<span id="example-partial-overlap"></span><span id="sphx-glr-example-gallery-raster-operations-parial-overlap-py"></span><h1>Partial overlap<a class="headerlink" href="#partial-overlap" title="Link to this heading"></a></h1>
<p>Merge rasters with different spatial extent</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>Since each BoundedGrid in GridKit has information on the bounds,
multiple grids can be combined in a way where their spatial extend is taken into account.
Basic mathematical operations were shown in the example <a class="reference internal" href="ndvi.html#example-ndvi"><span class="std std-ref">ndvi.py</span></a>,
but in that example the bands were fully overlapping.
In this example we are combining grids that are partially overlapping.
To combine the grids we will be taking the mean value for the cells that are shared between the grids.</p>
<p>In order to keep the scope of this test limited, three slices of tha same geotiff are used.
In most real cases, it is likely that these would be separate datasets that don’t perfectly match.
Note that in these cases, all datasets need to be resampled onto the same grid.
Also, since all slices in this example are from the same dataset,
the values in the overlapping sections will be identical, making for seamless fusing of the grids.
If the values in the overlapping area differ a lot between the datasets,
the seams won’t be as smooth.</p>
<p>That said, let’s read in the data.
The source of the DEM data used in this example is:
<a class="reference external" href="https://www.eea.europa.eu/data-and-maps/data/copernicus-land-monitoring-service-eu-dem">https://www.eea.europa.eu/data-and-maps/data/copernicus-land-monitoring-service-eu-dem</a></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gridkit</span> <span class="kn">import</span> <span class="n">read_raster</span>

<span class="n">path_dem</span> <span class="o">=</span> <span class="s2">&quot;../../tests/data/alps_dem.tiff&quot;</span>

<span class="n">dem1</span> <span class="o">=</span> <span class="n">read_raster</span><span class="p">(</span><span class="n">path_dem</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">29040</span><span class="p">,</span> <span class="mi">167500</span><span class="p">,</span> <span class="mi">29100</span><span class="p">,</span> <span class="mi">167620</span><span class="p">))</span>
<span class="n">dem2</span> <span class="o">=</span> <span class="n">read_raster</span><span class="p">(</span><span class="n">path_dem</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">29070</span><span class="p">,</span> <span class="mi">167470</span><span class="p">,</span> <span class="mi">29150</span><span class="p">,</span> <span class="mi">167580</span><span class="p">))</span>
<span class="n">dem3</span> <span class="o">=</span> <span class="n">read_raster</span><span class="p">(</span><span class="n">path_dem</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">29080</span><span class="p">,</span> <span class="mi">167520</span><span class="p">,</span> <span class="mi">29160</span><span class="p">,</span> <span class="mi">167600</span><span class="p">))</span>
</pre></div>
</div>
<p>Let’s group them for convenience</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dem_slices</span> <span class="o">=</span> <span class="p">[</span><span class="n">dem1</span><span class="p">,</span> <span class="n">dem2</span><span class="p">,</span> <span class="n">dem3</span><span class="p">]</span>
</pre></div>
</div>
<p>And then plot these data slices individually to see what we are dealing with</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">dem</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">dem_slices</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">dem</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_parial_overlap_001.png" srcset="../../_images/sphx_glr_parial_overlap_001.png" alt="parial overlap" class = "sphx-glr-single-img"/><p>It is hard to see from these three separate images which parts of the slices overlap.
If we visualize the <code class="docutils literal notranslate"><span class="pre">count</span></code> per cell, we can get a better idea on the distribution of the data.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gridkit</span>

<span class="n">dem_count</span> <span class="o">=</span> <span class="n">gridkit</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dem_slices</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dem_count</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">dem_count</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_parial_overlap_002.png" srcset="../../_images/sphx_glr_parial_overlap_002.png" alt="parial overlap" class = "sphx-glr-single-img"/><p>Now we have an idea on what the spatial distribution of the data looks like,
let’s take the mean of the datasets to combine them into one.
For each cell, this will take the mean value of all grids that cover it.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dem_mean</span> <span class="o">=</span> <span class="n">gridkit</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dem_slices</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dem_mean</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">dem_mean</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_parial_overlap_003.png" srcset="../../_images/sphx_glr_parial_overlap_003.png" alt="parial overlap" class = "sphx-glr-single-img"/><p>Beautiful, The data is merged!</p>
<p>In this case of course all values of the slices are the same, so the seams are perfectly smooth.
We can see the seems if we offset the values of the different slices a bit.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dem_mean</span> <span class="o">=</span> <span class="n">gridkit</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">dem1</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dem2</span><span class="p">,</span> <span class="n">dem3</span> <span class="o">+</span> <span class="mi">100</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dem_mean</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">dem_mean</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_parial_overlap_004.png" srcset="../../_images/sphx_glr_parial_overlap_004.png" alt="parial overlap" class = "sphx-glr-single-img"/><p>Now the seams become visible.
If this is a problem for your dataset,
consider cleaning the data before merging or smoothing the data after merging.</p>
<p>For smoothing the data afterwards, we can use scipy’s gaussian_filter.
Note that scipy treats our grid object as a numpy array,
so we need to update the existing grid with the array returned from the scipy function.
A larger convolution window (sigma) will result in more aggressive filtering.
This will result in smoother seams between slices,
but also remove high-frequency signal from your data.
When merging tiles therefore, a tradeoff will need to be reached that will differ per usecase.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>

<span class="n">filtered_data</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">dem_mean</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dem_filtered</span> <span class="o">=</span> <span class="n">dem_mean</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dem_filtered</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">dem_mean</span><span class="o">.</span><span class="n">mpl_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_parial_overlap_005.png" srcset="../../_images/sphx_glr_parial_overlap_005.png" alt="parial overlap" class = "sphx-glr-single-img"/><div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You may have noticed that area’s containing NaNs get exaggerated after filtering.
Scipy’s implementation of <code class="docutils literal notranslate"><span class="pre">gaussian_filter</span></code> does not take NaNs into account.
This means each pixel where the kernal contains a NaN will become NaN too.
If this is a problem for your dataset,
have a look at <a class="reference external" href="https://docs.astropy.org/en/stable/convolution/">astropy’s implementation</a>.</p>
</div>
</section>
<section id="nodata-values">
<h2>Nodata values<a class="headerlink" href="#nodata-values" title="Link to this heading"></a></h2>
<p>For each grid, the nodata value of that grid is also taken into account.
This means that values outside of the original extent of each respective data grid are not considered in the calculation.
If the data grids have different nodata_values, this still works, for each grid’s nodata_value is considered separately.
In that scenario the resulting product will have the nodata_value of the first grid.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.697 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-example-gallery-raster-operations-parial-overlap-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/ba020d52505c3a4aae7bfdefbbeefaa7/parial_overlap.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">parial_overlap.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/9a6e1eaf1678ffcab8854ededd78945a/parial_overlap.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">parial_overlap.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ndvi.html" class="btn btn-neutral float-left" title="NDVI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="resampling.html" class="btn btn-neutral float-right" title="Resampling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Timo Millenaar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <style>
    .rst-other-versions li.current a {
      font-weight: bold;
      color: #007bff;
    }
  </style>
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: v0.11.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/dev/index.html">dev</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v1.0.0/index.html">v1.0.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.14.1/index.html">v0.14.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.14.0/index.html">v0.14.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.13.0/index.html">v0.13.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.12.1/index.html">v0.12.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.12.0/index.html">v0.12.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.11.1/index.html">v0.11.1</a> 
        </li>
      
        <li class="current">
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.11.0/index.html">v0.11.0</a>   <--
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.10.0/index.html">v0.10.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.9.2/index.html">v0.9.2</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.9.1/index.html">v0.9.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.9.0/index.html">v0.9.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.8.0/index.html">v0.8.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.3/index.html">v0.7.3</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.2/index.html">v0.7.2</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.1/index.html">v0.7.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.0/index.html">v0.7.0</a> 
        </li>
      
    </dl>
    
    <br>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>