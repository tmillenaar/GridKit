<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gridkit.index &mdash; GridKit v0.10.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
    <link rel="canonical" href="https://tmilenaar.github.io/GridKit/versions/v0.10.0/_modules/gridkit/index.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=294cacf5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            GridKit
          </a>
              <div class="version">
                v0.10.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_gallery/index.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GridKit</a>
      </nav>

      <div class="wy-nav-content">
  
    <div style="
        background-color: #ffefc2;
        color: #333;
        padding: 1em;
        border-bottom: 2px solid #e6c200;
        font-weight: bold;
        text-align: center;
    ">
      You are viewing an <strong>outdated version</strong> of the documentation (v0.10.0).<br>
      Latest version: <a href="../../../v0.14.1/index.html">v0.14.1</a>
    </div>
  
  
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">gridkit.index</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gridkit.index</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span>


<div class="viewcode-block" id="validate_index">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.validate_index">[docs]</a>
<span class="k">def</span> <span class="nf">validate_index</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to convert the index argument of a function to a GridIndex object.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inner function to convert the index argument to a GridIndex object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: Union[numpy.ndarray, list, tuple, GridIndex]</span>
<span class="sd">            The index referring to the grid IDs</span>
<span class="sd">        *args:</span>
<span class="sd">            The arguments to be passed to the wrapped function</span>
<span class="sd">        *kwargs:</span>
<span class="sd">            The keyword arguments to be passed to the wrapped function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arg_names</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">new_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg_names</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">new_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">new_kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">new_args</span><span class="p">,</span> <span class="o">**</span><span class="n">new_kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="concat">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.concat">[docs]</a>
<span class="k">def</span> <span class="nf">concat</span><span class="p">(</span><span class="n">grid_ids</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Concatenate supplied GridIndex instances into one.</span>
<span class="sd">    Duplicate indices are allowed.</span>
<span class="sd">    If duplicates are not desired for your usecase,</span>
<span class="sd">    consider calling :meth:`.GridIndex.unique` after concatenating.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    grid_ids: :class: List</span>
<span class="sd">        A list of GridIndex isntances to concatenate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">combined_id</span> <span class="o">=</span> <span class="n">GridIndex</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">grid_ids</span><span class="p">:</span>
        <span class="n">combined_id</span> <span class="o">=</span> <span class="n">combined_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">combined_id</span></div>



<span class="k">def</span> <span class="nf">_normal_op</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">r</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_reverse_op</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)))</span>


<span class="k">class</span> <span class="nc">_IndexMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metaclass for GridIndex which implements the basic operators&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">name_</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="c1"># mathematical operators</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">,</span> <span class="s2">&quot;mul&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">true_divide</span><span class="p">,</span> <span class="s2">&quot;truediv&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">,</span> <span class="s2">&quot;floordiv&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">,</span> <span class="s2">&quot;pow&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span> <span class="s2">&quot;mod&quot;</span><span class="p">),</span>
            <span class="c1"># comparison operators</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">,</span> <span class="s2">&quot;ge&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">less_equal</span><span class="p">,</span> <span class="s2">&quot;le&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">greater</span><span class="p">,</span> <span class="s2">&quot;gt&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">less</span><span class="p">,</span> <span class="s2">&quot;lt&quot;</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">opname</span> <span class="o">=</span> <span class="s2">&quot;__</span><span class="si">{}</span><span class="s2">__&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name_</span><span class="p">)</span>
            <span class="n">opname_reversed</span> <span class="o">=</span> <span class="s2">&quot;__r</span><span class="si">{}</span><span class="s2">__&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name_</span><span class="p">)</span>
            <span class="n">namespace</span><span class="p">[</span><span class="n">opname</span><span class="p">]</span> <span class="o">=</span> <span class="n">_normal_op</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="n">namespace</span><span class="p">[</span><span class="n">opname_reversed</span><span class="p">]</span> <span class="o">=</span> <span class="n">_reverse_op</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">name_</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">equal</span><span class="p">,</span> <span class="s2">&quot;eq&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">not_equal</span><span class="p">,</span> <span class="s2">&quot;ne&quot;</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">opname</span> <span class="o">=</span> <span class="s2">&quot;__</span><span class="si">{}</span><span class="s2">__&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name_</span><span class="p">)</span>
            <span class="n">opname_reversed</span> <span class="o">=</span> <span class="s2">&quot;__r</span><span class="si">{}</span><span class="s2">__&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name_</span><span class="p">)</span>
            <span class="n">namespace</span><span class="p">[</span><span class="n">opname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gen_comparisson_op</span><span class="p">(</span><span class="n">_normal_op</span><span class="p">(</span><span class="n">op</span><span class="p">))</span>
            <span class="n">namespace</span><span class="p">[</span><span class="n">opname_reversed</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gen_comparisson_op</span><span class="p">(</span><span class="n">_reverse_op</span><span class="p">(</span><span class="n">op</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_gen_comparisson_op</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">comparison_op</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">GridIndex</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">GridIndex</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">op</span>
            <span class="k">if</span> <span class="n">left</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="n">right</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">right</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                <span class="n">left</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">right</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">y</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">comparison_op</span>


<div class="viewcode-block" id="GridIndex">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex">[docs]</a>
<span class="k">class</span> <span class="nc">GridIndex</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">_IndexMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index to be used with grid classes.</span>
<span class="sd">    These GridIndex class instances contain the references to the grid cells by ID (idx, idy).</span>
<span class="sd">    Several methods are implemented to treat the indices as sets, where one (idx, idy) pair is considered one unit, one cell-ID.</span>
<span class="sd">    The GridIndex class also allows for generic operators such as: (+, -, *, /, //, **, %, &gt;=, &lt;=, &gt;, &lt;)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    index: Union[numpy.ndarray, list, tuple, GridIndex]</span>
<span class="sd">        The index containing the cell-id.</span>
<span class="sd">        This is assumed to either be a single (idx, idy) pair or a list, tuple or ndarray containing multiple of such pairs.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        When the shape of the index does not match the expected shape of (2,) or (N,2) where N is the number of cells, a ValuError is raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span>
            <span class="n">index</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">integer</span>
        <span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The last axis should contain two elements (an x and a y coordinate). Got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> elements instead.&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="GridIndex.from_index_1d">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.from_index_1d">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_index_1d</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">combined</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn 1d-view into GridIndex&quot;&quot;&quot;</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">combined</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
        <span class="c1"># Extract the first 32 bits</span>
        <span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">((</span><span class="n">combined</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
        <span class="c1"># Extract the last 32 bits</span>
        <span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">combined</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of indices&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_id</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">GridIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter_id</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># There is only one value, on which getitem is not supported</span>
            <span class="c1"># Turn into array so getitem works</span>
            <span class="n">index_1d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">])[</span><span class="n">item</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">GridIndex</span><span class="o">.</span><span class="n">from_index_1d</span><span class="p">(</span><span class="n">index_1d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GridIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The X-component of the cell-IDs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@x</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The Y-component of the cell-IDs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@y</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="GridIndex.unique">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.unique">[docs]</a>
    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The unique IDs contained in the index. Remove duplicate IDs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            The keyword arguments to pass to numpy.unique</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># kwargs to numpy.unique can result in multiple return arguments, return these too</span>
            <span class="n">unique</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">GridIndex</span><span class="o">.</span><span class="n">from_index_1d</span><span class="p">(</span><span class="n">unique</span><span class="p">),</span> <span class="o">*</span><span class="n">other</span>
        <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GridIndex</span><span class="o">.</span><span class="n">from_index_1d</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridIndex.sort">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.sort">[docs]</a>
    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sort the grid indices. Multidimentional indices are not supported.</span>
<span class="sd">        Ravels the indices if indices are multidimentional.</span>

<span class="sd">        The indices are sorted first by x, then by y.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`.GridIndex`</span>
<span class="sd">            The sorted ids</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from gridkit.index import GridIndex</span>
<span class="sd">        &gt;&gt;&gt; unsorted_ids = GridIndex([[1,1],[0,1],[1,0],[0,0]])</span>
<span class="sd">        &gt;&gt;&gt; sorted_ids = unsorted_ids.sort()</span>
<span class="sd">        &gt;&gt;&gt; sorted_ids.index</span>
<span class="sd">        array([[0, 0],</span>
<span class="sd">               [0, 1],</span>
<span class="sd">               [1, 0],</span>
<span class="sd">               [1, 1]], dtype=int32)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GridIndex</span><span class="o">.</span><span class="n">from_index_1d</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">))</span></div>


<div class="viewcode-block" id="GridIndex.intersection">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.intersection">[docs]</a>
    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The intersection of two GridIndex instances. Keep the IDs contained in both.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: :class:`~.GridIndex`</span>
<span class="sd">            The GridIndex instance to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GridIndex</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">intersection</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">index_1d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GridIndex</span><span class="o">.</span><span class="n">from_index_1d</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridIndex.difference">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.difference">[docs]</a>
    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The difference of two GridIndex instances. Keep the IDs contained in ``self`` that are not in ``other``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: :class:`~.GridIndex`</span>
<span class="sd">            The GridIndex instance to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GridIndex</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">index_1d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GridIndex</span><span class="o">.</span><span class="n">from_index_1d</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridIndex.isdisjoint">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.isdisjoint">[docs]</a>
    <span class="k">def</span> <span class="nf">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if none of the IDs in ``self`` are in ``other``. False if any ID in ``self`` is also in ``other``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: :class:`~.GridIndex`</span>
<span class="sd">            The GridIndex instance to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">~</span><span class="n">numpy</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">index_1d</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span></div>


<div class="viewcode-block" id="GridIndex.issubset">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.issubset">[docs]</a>
    <span class="k">def</span> <span class="nf">issubset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if all of the IDs in ``self`` are in ``other``. False if not all IDs in ``self`` is also in ``other``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: :class:`~.GridIndex`</span>
<span class="sd">            The GridIndex instance to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">index_1d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>


<div class="viewcode-block" id="GridIndex.issuperset">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.issuperset">[docs]</a>
    <span class="k">def</span> <span class="nf">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if all of the IDs in ``other`` are in ``self``. False if not all IDs in ``other`` is also in ``self``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: :class:`~.GridIndex`</span>
<span class="sd">            The GridIndex instance to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">index_1d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_1d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_1d_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a structured array where each (x,y) pair is seen as a single entitiy.</span>

<span class="sd">        .. Note ::</span>

<span class="sd">            This property is deprecated in favor of :meth:`.GridIndex.index_1d`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;&#39;_1d_view&#39; is deprecated in favor of &#39;index_1d&#39;&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">raveled_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raveled_index</span><span class="p">),</span> <span class="n">raveled_index</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">raveled_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="k">else</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">[</span><span class="n">raveled_index</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;f0&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">],</span> <span class="s2">&quot;formats&quot;</span><span class="p">:</span> <span class="n">formats</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">raveled_index</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">]:</span>  <span class="c1"># https://stackoverflow.com/a/63196035</span>
            <span class="n">raveled_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">raveled_index</span><span class="p">,</span> <span class="n">requirements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">raveled_index</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index_1d</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn index based on x,y into a single integer. Assumes x and y are 32-bit integers&quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>

        <span class="n">index</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>

        <span class="c1"># Combine the integers into a single 64-bit integer</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">combined</span>

<div class="viewcode-block" id="GridIndex.ravel">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.ravel">[docs]</a>
    <span class="k">def</span> <span class="nf">ravel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten a nd-index</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; from gridkit.index import GridIndex</span>
<span class="sd">            &gt;&gt;&gt; import numpy</span>
<span class="sd">            &gt;&gt;&gt; index = GridIndex(numpy.arange(2*3*2).reshape(2,3,2))</span>
<span class="sd">            &gt;&gt;&gt; index.index</span>
<span class="sd">            array([[[ 0,  1],</span>
<span class="sd">                    [ 2,  3],</span>
<span class="sd">                    [ 4,  5]],</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">                   [[ 6,  7],</span>
<span class="sd">                    [ 8,  9],</span>
<span class="sd">                    [10, 11]]])</span>
<span class="sd">            &gt;&gt;&gt; flat_index = index.ravel()</span>
<span class="sd">            &gt;&gt;&gt; flat_index.index</span>
<span class="sd">            array([[ 0,  1],</span>
<span class="sd">                   [ 2,  3],</span>
<span class="sd">                   [ 4,  5],</span>
<span class="sd">                   [ 6,  7],</span>
<span class="sd">                   [ 8,  9],</span>
<span class="sd">                   [10, 11]])</span>

<span class="sd">        ..</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`GridIndex`</span>
<span class="sd">            A flattened copy of te index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GridIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span></div>


<div class="viewcode-block" id="GridIndex.append">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.append">[docs]</a>
    <span class="nd">@validate_index</span>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add cell ids to the end of the current index.</span>
<span class="sd">        This updates the .index attribute in-place as would an append on a python list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: :class:`GridIndex`</span>
<span class="sd">            The cell_ids to append to the current index</span>
<span class="sd">        in_place: :class:`bool` (optional, default False )</span>
<span class="sd">            Updates the index of ``self`` if True.</span>
<span class="sd">            Returns a copy if False.</span>
<span class="sd">            Note: This does not improve performance as you might expect form a true in-place operation.</span>
<span class="sd">            The copy is made regardless since the data stored in the GridIndex is based on a numpy</span>
<span class="sd">            array and not on a Python List.</span>
<span class="sd">            The ``in-place`` option is for convenience only, not performance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; cell_ids = GridIndex([0,1])</span>
<span class="sd">            &gt;&gt;&gt; cell_ids.index</span>
<span class="sd">            array([0, 1])</span>
<span class="sd">            &gt;&gt;&gt; result = cell_ids.append([-5,9])</span>
<span class="sd">            &gt;&gt;&gt; result.index</span>
<span class="sd">            array([[ 0,  1],</span>
<span class="sd">                   [-5,  9]])</span>

<span class="sd">        ..</span>

<span class="sd">        Alternatively, by specifying ``in_place=True`` the original object can be updated.</span>
<span class="sd">        As noted at the ``in_place`` parameter description, this does not result in performance gains.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; cell_ids.append([-5,9], in_place=True)</span>
<span class="sd">            &lt;gridkit.index.GridIndex object at ...&gt;</span>
<span class="sd">            &gt;&gt;&gt; cell_ids.index</span>
<span class="sd">            array([[ 0,  1],</span>
<span class="sd">                   [-5,  9]])</span>

<span class="sd">        ..</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">index</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="GridIndex.delete">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.delete">[docs]</a>
    <span class="nd">@validate_index</span>
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove all instances of &#39;item&#39; from self.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: :class:`GridIndex`</span>
<span class="sd">            The cell ids to remove from ``self``</span>
<span class="sd">        in_place: :class:`bool` (optional, default False )</span>
<span class="sd">            Updates the index of ``self`` if True.</span>
<span class="sd">            Returns a copy if False.</span>
<span class="sd">            Note: This does not improve performance as you might expect form a true in-place operation.</span>
<span class="sd">            The copy is made regardless since the data stored in the GridIndex is based on a numpy</span>
<span class="sd">            array and not on a Python List.</span>
<span class="sd">            The ``in-place`` option is for convenience only, not performance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`GridIndex`</span>
<span class="sd">            The new index where the supplied ids were removed</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code-block::python</span>

<span class="sd">            &gt;&gt;&gt; start_index = GridIndex([[0,1], [2,3], [0,1]])</span>
<span class="sd">            &gt;&gt;&gt; start_index.index</span>
<span class="sd">            array([[0, 1],</span>
<span class="sd">                   [2, 3],</span>
<span class="sd">                   [0, 1]])</span>
<span class="sd">            &gt;&gt;&gt; reduced_index = start_index.delete([0,1])</span>
<span class="sd">            &gt;&gt;&gt; reduced_index.index</span>
<span class="sd">            array([2, 3])</span>

<span class="sd">        ..</span>

<span class="sd">        Alternatively, by specifying ``in_place=True`` the original object can be updated.</span>
<span class="sd">        As noted at the ``in_place`` parameter description, this does not result in performance gains.</span>

<span class="sd">        .. code-block::python</span>

<span class="sd">            &gt;&gt;&gt; start_index.delete([0,1], in_place=True)</span>
<span class="sd">            &lt;gridkit.index.GridIndex object at ...&gt;</span>
<span class="sd">            &gt;&gt;&gt; start_index.index</span>
<span class="sd">            array([2, 3])</span>

<span class="sd">        ..</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index</span> <span class="k">for</span> <span class="n">cell_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="n">masked_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">masked_index</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">masked_index</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">masked_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">masked_index</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="GridIndex.copy">
<a class="viewcode-back" href="../../api/gridkit.index.html#gridkit.index.GridIndex.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an immutable copy of self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GridIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>
</div>



<span class="k">def</span> <span class="nf">_nd_view</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn 1d-view into ndarray&quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;&#39;_nd_view&#39; is deprecated in favor of &#39;GridIndex.from_index_1d&#39;&quot;</span><span class="p">,</span>
        <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># return index if empty</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">index</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">GridIndex</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Timo Millenaar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <style>
    .rst-other-versions li.current a {
      font-weight: bold;
      color: #007bff;
    }
  </style>
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: v0.10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/dev/index.html">dev</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.14.1/index.html">v0.14.1</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.14.0/index.html">v0.14.0</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.13.0/index.html">v0.13.0</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.12.1/index.html">v0.12.1</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.12.0/index.html">v0.12.0</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.11.1/index.html">v0.11.1</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.11.0/index.html">v0.11.0</a> 
        </li>
      
        <li class="current">
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.10.0/index.html">v0.10.0</a>   <--
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.9.2/index.html">v0.9.2</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.9.1/index.html">v0.9.1</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.9.0/index.html">v0.9.0</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.8.0/index.html">v0.8.0</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.7.3/index.html">v0.7.3</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.7.2/index.html">v0.7.2</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.7.1/index.html">v0.7.1</a> 
        </li>
      
        <li >
          <a href="https://tmilenaar.github.io/GridKit/versions/v0.7.0/index.html">v0.7.0</a> 
        </li>
      
    </dl>
    
    <br>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>