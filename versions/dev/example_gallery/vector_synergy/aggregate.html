

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aggregate from points &mdash; GridKit dev documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
    <link rel="canonical" href="https://tmillenaar.github.io/GridKit/versions/dev/example_gallery/vector_synergy/aggregate.html" />
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=3ce10a4d"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Geometry intersections" href="intersect_geometries.html" />
    <link rel="prev" title="Combining land cover and DEM" href="../raster_operations/elevation_distribution_per_land_cover.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            GridKit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Example Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#cell-centric">Cell centric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#grid-definitions">Grid definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#patterns-created-from-regular-grid-interactions">Patterns created from regular grid interactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#raster-operations">Raster operations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#vector-data-interactions">Vector data interactions</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Aggregate from points</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-input-data">Generate input data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#relate-points-to-grid-cells">Relate points to grid cells</a></li>
<li class="toctree-l4"><a class="reference internal" href="#count-the-points-per-cell">Count the points per cell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualize-the-results">Visualize the results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intersect_geometries.html">Geometry intersections</a></li>
<li class="toctree-l3"><a class="reference internal" href="aggregate_dask.html">Tiled aggregation from points with Dask</a></li>
<li class="toctree-l3"><a class="reference internal" href="interpolate_from_points.html">Interpolate from points</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GridKit</a>
      </nav>

      <div class="wy-nav-content">
  
    <div style="
        background-color: #f5dfed;
        color:#2d2c2e;
        padding: 1em;
        border-bottom: 2px solid #ecacfa;
        font-weight: bold;
        text-align: center;
    ">
      You are viewing the <strong>development version</strong> of the documentation (dev).<br>
      This is the bleeding edge. Changes might not yet be released and may be changed or reverted.
    </div>
  
  
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Example Gallery</a></li>
      <li class="breadcrumb-item active">Aggregate from points</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/example_gallery/vector_synergy/aggregate.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-example-gallery-vector-synergy-aggregate-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="aggregate-from-points">
<span id="example-aggregate"></span><span id="sphx-glr-example-gallery-vector-synergy-aggregate-py"></span><h1>Aggregate from points<a class="headerlink" href="#aggregate-from-points" title="Link to this heading"></a></h1>
<p>Group points into grid cells</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a tiled implementation of this approach using Dask, see example <a class="reference internal" href="aggregate_dask.html#example-aggregate-dask"><span class="std std-ref">aggregate_dask.py</span></a></p>
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>Grouping points in cells (here referred to as ‘aggregation’) is a common occurrence in spatial data processing.
This is often used to generate heatmaps, obtain statistics of the data or to reduce the size of the data for easier processing.
By grouping nearby points in the same cell,
you can for example calculate the standard deviation to get a feel for the variability of your data.</p>
<p>In this example we will count the number of points in a cell.
This gives a sense of the distribution of the points.
Other common operations for this kind of exercise are:
std, mean, median, percentile, min and max.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Groupby operations can also be done on polygons of arbitrary shape.
If this is of interest to you, have a look at <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.sjoin.html">GeoPanda’s sjoin</a></p>
</div>
</section>
<section id="generate-input-data">
<h2>Generate input data<a class="headerlink" href="#generate-input-data" title="Link to this heading"></a></h2>
<p>Let’s start by generating some points.
The data will be a set of points scattered around a circle to create
a dougnut-like shape.
I’ll plot the input here to show what it looks like.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">gridkit.doc_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_2d_scatter_doughnut</span><span class="p">,</span> <span class="n">plot_polygons</span>

<span class="n">points</span> <span class="o">=</span> <span class="n">generate_2d_scatter_doughnut</span><span class="p">(</span><span class="n">num_points</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Create the scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Doughnut with Gaussian Scattering&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_aggregate_001.png" srcset="../../_images/sphx_glr_aggregate_001.png" alt="Doughnut with Gaussian Scattering" class = "sphx-glr-single-img"/></section>
<section id="relate-points-to-grid-cells">
<h2>Relate points to grid cells<a class="headerlink" href="#relate-points-to-grid-cells" title="Link to this heading"></a></h2>
<p>Now we can create a grid and aggregate our points onto that grid.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">gridkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">HexGrid</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">HexGrid</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;flat&quot;</span><span class="p">)</span>
<span class="n">cell_ids</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">cell_at_point</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="count-the-points-per-cell">
<h2>Count the points per cell<a class="headerlink" href="#count-the-points-per-cell" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cell_ids</span></code> obtained in the previous step can be used to group the points.
Each point with the same ‘cell_id’ will be regarded as being in the same ‘bin’.
We can then do statistics on these bins. In our case we will count the number of points per bin.
For convenience, I will use a panda’s groupby functionality for this.
Note that <a class="reference internal" href="../../api/gridkit.index.html#gridkit.index.GridIndex.index_1d" title="gridkit.index.GridIndex.index_1d"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GridIndex.index_1d()</span></code></a> is used here, and not <cite>GridIndex.index</cite>.
In the latter the x and y ids are split, which does not work well with DataFrames.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;nr_points&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;cell_id&quot;</span><span class="p">:</span> <span class="n">cell_ids</span><span class="o">.</span><span class="n">index_1d</span><span class="p">}</span>
<span class="p">)</span>  <span class="c1"># The &#39;nr_points&#39; will contain the result after `.count()` is called</span>
<span class="n">occurrences</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="visualize-the-results">
<h2>Visualize the results<a class="headerlink" href="#visualize-the-results" title="Link to this heading"></a></h2>
<p>Now we have the number of points per cell, let’s obtain the corresponding cell shapes from the grid object and plot them.
Since we used <a class="reference internal" href="../../api/gridkit.index.html#gridkit.index.GridIndex.index_1d" title="gridkit.index.GridIndex.index_1d"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GridIndex.index_1d()</span></code></a>,
we will have to convert that back into a GridIndex using <a class="reference internal" href="../../api/gridkit.index.html#gridkit.index.GridIndex.from_index_1d" title="gridkit.index.GridIndex.from_index_1d"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GridIndex.from_index_1d()</span></code></a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">gridkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridIndex</span>

<span class="n">occurrences_ids</span> <span class="o">=</span> <span class="n">GridIndex</span><span class="o">.</span><span class="n">from_index_1d</span><span class="p">(</span><span class="n">occurrences</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">geoms</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">to_shapely</span><span class="p">(</span><span class="n">occurrences_ids</span><span class="p">)</span>
<span class="n">plot_polygons</span><span class="p">(</span><span class="n">geoms</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">occurrences</span><span class="p">[</span><span class="s2">&quot;nr_points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Oranges&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of points per cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_aggregate_002.png" srcset="../../_images/sphx_glr_aggregate_002.png" alt="Number of points per cell" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.394 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-example-gallery-vector-synergy-aggregate-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/59a915f944b0f9e57a3c5fbf3640acb8/aggregate.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">aggregate.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/4d73bd6bf6fc9c41c92bd89a0a7cb573/aggregate.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">aggregate.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/72f54bfd10f9986ed4c52e4d6cd00e8f/aggregate.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">aggregate.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../raster_operations/elevation_distribution_per_land_cover.html" class="btn btn-neutral float-left" title="Combining land cover and DEM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="intersect_geometries.html" class="btn btn-neutral float-right" title="Geometry intersections" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Timo Millenaar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <style>
    .rst-other-versions li.current a {
      font-weight: bold;
      color: #007bff;
    }
  </style>
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: dev
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      
        <li class="current">
          <a href="https://tmillenaar.github.io/GridKit/versions/dev/index.html">dev</a>   <--
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v1.0.0/index.html">v1.0.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.14.1/index.html">v0.14.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.14.0/index.html">v0.14.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.13.0/index.html">v0.13.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.12.1/index.html">v0.12.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.12.0/index.html">v0.12.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.11.1/index.html">v0.11.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.11.0/index.html">v0.11.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.10.0/index.html">v0.10.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.9.2/index.html">v0.9.2</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.9.1/index.html">v0.9.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.9.0/index.html">v0.9.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.8.0/index.html">v0.8.0</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.3/index.html">v0.7.3</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.2/index.html">v0.7.2</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.1/index.html">v0.7.1</a> 
        </li>
      
        <li >
          <a href="https://tmillenaar.github.io/GridKit/versions/v0.7.0/index.html">v0.7.0</a> 
        </li>
      
    </dl>
    
    <br>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>